<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Canvas tests</title>
	<style type="text/css">
		body{
			margin: 40px auto;
			max-width: 650px;
			line-height: 1.2;
			font-size: 18px;
			color: #444;
			padding: 0 10px;
			background: #abcbf7;
		}

		/*html{
			box-shadow: 0 0 50vh #00f inset;
			height: 100vh;
		}*/

		h1, h2, h3{
			line-height: 1.2;
			color: #121de8;
			text-shadow: 0 0 20px #fff;
		}

		strong{
			color: #e85656;
		}

		p, canvas{
			margin: 5px auto;
			padding: 3px;
			border: 1px solid #088;
			border-radius: 5px;
			box-shadow: 0 0 5px #088;
			background: #ccc;
		}
	</style>
</head>
<body>
<h1>A canvas test with the Syracuse sequence</h1>
<p>Hello <strong>world</strong>!</p>
<canvas id="hwGraph" height="300" width="300">No Canvas JS</canvas>

<p>$$ H_{t+1} = h + r_h H_t + I_{HW}(W_t) $$</p>
<p>$$ W_{t+1} = w + r_w W_t + I_{WH}(H_t) $$</p>

<script>
function moodGen(hStart, wStart, h, w, rH, rW, infWH, infHW, lim) {
	hMood = [hStart];
	wMood = [wStart];
	for (let i = 0; i < lim; i++) {
		let hNext = h + rH * hMood[hMood.length - 1] + infWH(wMood[wMood.length - 1]);
		let wNext = w + rW * wMood[wMood.length - 1] + infHW(hMood[hMood.length - 1]);
		hMood.push(hNext);
		wMood.push(wNext);
	}
	return [hMood, wMood];
}

function drawMoodTime() {
	//data retrieval part
	let hStart = 10;
	let wStart = 10;
	let h = -1.89;
	let w = -2.26;
	let rH = 0.30;
	let rW = 0.42;
	let infWH = function (w) {
		let threshNeg = -6.06;
		let threshPos = 7.24;
		let resp = [-5, -1, 1, 5];
		let ret = 0;
		if (w < threshNeg) {
			ret = resp[0];
		} else if (w < 0) {
			ret = resp[1];
		} else if (w < 1) {
			ret = resp[2];
		} else {
			ret = resp[3];
		}
		return ret;
	}
	let infHW = function (w) {
		let threshNeg = -7.71;
		let threshPos = 6.65;
		let resp = [-5, -1, 1, 5];
		let ret = 0;
		if (w < threshNeg) {
			ret = resp[0];
		} else if (w < 0) {
			ret = resp[1];
		} else if (w < 1) {
			ret = resp[2];
		} else {
			ret = resp[3];
		}
		return ret;
	}
	let lim = 100;
	moods = moodGen(hStart, wStart, h, w, rH, rW, infWH, infHW, lim);
	let wMood = moods[0];
	let hMood = moods[1];

	//display graph
	drawXY(document.getElementById("hwGraph"), hMood, wMood);
}

function drawXY(canvas, x, y) {
	//get and init. canvas context and style
	let ctx = canvas.getContext('2d');
	ctx.translate(0, canvas.height);
	ctx.scale(1, -1);
	ctx.clearRect(0, 0, canvas.width, canvas.height);

	//get data
	let seqLen = x.length;
	let xMin = x[0];
	let xMax = x[0];
	let yMin = y[0];
	let yMax = y[0];
	for (let i = 0; i < seqLen; i++) {
		xMin = Math.min(xMin, x[i]);
		xMax = Math.max(xMax, x[i]);
		yMin = Math.min(yMin, y[i]);
		yMax = Math.max(yMax, y[i]);
	}
	xMin *= -0.5;
	yMin *= -0.5;
	console.log(xMin, xMax, yMin, yMax);

	//draw axis
	ctx.strokeStyle = '#e85656';
	//x-axis
	ctx.moveTo(0, (canvas.height / (yMax - yMin)) * (-yMin));
	ctx.lineTo(canvas.width, (canvas.height / (yMax - yMin)) * (-yMin));
	ctx.stroke();
	//y-axis
	ctx.moveTo((canvas.width / (xMax - xMin)) * (-xMin), 0);
	ctx.lineTo((canvas.width / (xMax - xMin)) * (-xMin), canvas.height);
	ctx.stroke();

	//draw graph
	ctx.strokeStyle = '#088';
	ctx.beginPath();
	ctx.moveTo((canvas.width / (xMax - xMin)) * (x[0] - xMin), (canvas.height / (yMax - yMin)) * (y[0] - yMin));
	for (let i = 1; i < seqLen; i++) {
		let nextX = (canvas.width  / (xMax - xMin)) * (x[i] - xMin);
		let nextY = (canvas.height / (yMax - yMin)) * (y[i] - yMin);
		ctx.lineTo(nextX, nextY);
	}
	ctx.stroke();
}

drawMoodTime();

/*
function seqGen(n) {
	return function () {
		n = n%2 ? n*3+1 : n/2;
		return n!==1 ? n : null;
	};
}

function draw(seqStart) {
	ctx.clearRect(0, 0, canvas.width, canvas.height);

	ctx.fillStyle = '#088';
	let gen = seqGen(seqStart);
	let x = [];
	let y = [];
	let seqLen = 0;
	let seqMax = seqStart;
	while (y[y.length-1] !== null) {
		x.push(seqLen++);
		y.push(gen());
		if (seqMax < y[seqLen-1]) {
			seqMax = y[seqLen-1];
		}
	}

	ctx.beginPath();
	ctx.moveTo(0, canvas.height/seqMax*seqStart);
	for (let i = 0; i < seqLen-1; i++) {
		ctx.lineTo(canvas.width/seqLen*x[i+1], canvas.height/seqMax*y[i+1]);
	}
	ctx.lineTo(0, 0);
	ctx.fill();
	ydisp.innerHTML = 'Longueur : ' + seqLen + '<br/>Séquence : ' + y.join(', ');
}

let input = document.getElementById('seqStart');
input.value = Math.floor(Math.random()*1e5)%1e3;
input.onchange = function () {
	draw(this.value);
};

draw(input.value);
//*/
</script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>

